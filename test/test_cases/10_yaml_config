apiVersion: v1
kind: Secret
metadata:
  name: app-secrets
  namespace: production
type: Opaque
data:
  # Base64 encoded secrets (these would normally be encoded)
  database-username: YXBwX3VzZXI=
  database-password: UzNjdXIzUEBzc3cwcmQhMjAyNA==
  api-key: c2stbGl2ZV81MUhxSjlDS0t2SXIzSWg=
stringData:
  # Plain text secrets that k8s will encode
  jwt-secret: "my-super-secret-jwt-key-2024"
  redis-url: "redis://admin:RedisPass123!@redis.example.com:6379/0"
  
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
  namespace: production
spec:
  replicas: 3
  selector:
    matchLabels:
      app: myapp
  template:
    metadata:
      labels:
        app: myapp
    spec:
      containers:
      - name: app
        image: myapp:latest
        env:
        - name: DATABASE_URL
          value: "postgresql://app_user:S3cur3P@ssw0rd!2024@db.example.com:5432/myapp_prod?sslmode=require"
        - name: REDIS_URL
          valueFrom:
            secretKeyRef:
              name: app-secrets
              key: redis-url
        - name: JWT_SECRET
          valueFrom:
            secretKeyRef:
              name: app-secrets
              key: jwt-secret
        - name: STRIPE_SECRET_KEY
          value: "sk_live_51HqJ9CKKvIr3Ih1234567890abcdef"
        - name: SENDGRID_API_KEY
          value: "SG.1234567890abcdef.qrstuvwxyz1234567890"
        - name: AWS_ACCESS_KEY_ID
          value: "AKIAIOSFODNN7EXAMPLE"
        - name: AWS_SECRET_ACCESS_KEY
          value: "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"
        ports:
        - containerPort: 8080
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"

---
# Docker Compose equivalent for local development
version: '3.8'
services:
  app:
    build: .
    ports:
      - "8080:8080"
    environment:
      - DATABASE_URL=postgresql://dev_user:DevPass123@localhost:5432/myapp_dev
      - REDIS_URL=redis://localhost:6379/0
      - JWT_SECRET=dev-jwt-secret-not-for-production
      - STRIPE_SECRET_KEY=sk_test_1234567890abcdef
      - NODE_ENV=development
    depends_on:
      - db
      - redis
      
  db:
    image: postgres:15
    environment:
      - POSTGRES_DB=myapp_dev
      - POSTGRES_USER=dev_user
      - POSTGRES_PASSWORD=DevPass123
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
      
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    command: redis-server --requirepass RedisDevPass456

volumes:
  postgres_data: 